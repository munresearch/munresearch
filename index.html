<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

<!DOCTYPE html>
<html>
<head>
  <title>MUN Research</title>
</head>
<body>
  <header id="header" class="bg-dark" style="margin: 0 0 25px 0">
    <h1>MUN Research</h1>
  </header>
  <form class="form-inline my-2 my-lg-0" action="/searchagenda" method="post" style="margin: 25px 0 0 25px">
    <label for="promptagenda" style="margin: 0 10px 0 0">Enter your agenda:</label><br>
    <input class="form-control mr-sm-2" aria-label="Enter your agenda" type="text" id="promptagenda" name="promptagenda"><br>
    <label for="promptcountry" style="margin: 0 10px 0 0">Enter your country:</label><br>
    <input class="form-control mr-sm-2" aria-label="Enter your cCountry" type="text" id="promptcountry" name="promptcountry"><br>
    <input class="btn btn-outline-success my-2 my-sm-0" type="submit" value="Submit">
  </form>

  <h3 style="margin: 25px 0 5px 25px">Country Information (information from the World Bank)</h3>
  <div>
  <div style="margin: 0 25px 0 25px">
  <table class="table">
   <thead>
    <tr>
      <th>Capital</th>
      <th>Region</th>
      <th>Economic Status</th>
    </tr>
   </thead>
   <tbody>
    <tr>
      <td id="capital"></td>
      <td id="region"></td>
      <td id="econstatus"></td>
    </tr>
   </tbody>
  </table>
  </div>
  </div>

  <h3 style="margin: 25px 0 5px 25px">Research Papers (sourced from <a href="https://core.ac.uk">core.ac.uk</a>)</h3>
  <div> 
  <div style="margin: 0 25px 0 25px">
  <table class="table">
   <thead>
    <tr>
      <th>Paper 1</th>
      <th>Paper 2</th>
      <th>Paper 3</th>
      <th>Paper 4</th>
      <th>Paper 5</th>
      <th>Paper 6</th>
    </tr>
   </thead>
   <tbody>
    <tr>
      <td id="result1"></td>
      <td id="result2"></td>
      <td id="result3"></td>
      <td id="result4"></td>
      <td id="result5"></td>
      <td id="result6"></td>
    </tr>
   </tbody>
  </table>
  </div>
  </div>

  <footer id="footer" class="bg-dark py-3">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark container">
      <ul class="navbar-nav mr-auto">
          <li class="nav-link">Made by <a href="https://github.com/AshutoshSundresh">Ashutosh Sundresh</a></li>
      </ul>
      <span class="navbar-text text-light">Made in 2022</span>
    </nav>
  </footer>

  <script>
    const searchagenda = async () => {
      // Get the search prompt from the form
      const promptagenda = document.getElementById("promptagenda").value;
      const promptcountry = document.getElementById("promptcountry").value;

      // Using the Google Search API to get search results, this key fetches results from Google Scholar
      var url = "https://www.googleapis.com/customsearch/v1?key=AIzaSyD_2AzYp5WRBLkVxoAdPV8r9XBxrtsOe5w&cx=146c71ac6b2fe4aa7&q=" + promptagenda;
      var xhr = new XMLHttpRequest();
      xhr.open("GET", url);
      xhr.send();
      xhr.onload = function() {
        var response = JSON.parse(xhr.response);
        // Update the table with the search results
        document.getElementById("result1").innerHTML = '<a href="'+ response.items[0].link + '">"'+ response.items[0].title + '"</a>';
        document.getElementById("result2").innerHTML = '<a href="'+ response.items[1].link + '">"'+ response.items[1].title + '"</a>';
        document.getElementById("result3").innerHTML = '<a href="'+ response.items[2].link + '">"'+ response.items[2].title + '"</a>';
        document.getElementById("result4").innerHTML = '<a href="'+ response.items[3].link + '">"'+ response.items[3].title + '"</a>';
        document.getElementById("result5").innerHTML = '<a href="'+ response.items[4].link + '">"'+ response.items[4].title + '"</a>';
        document.getElementById("result6").innerHTML = '<a href="'+ response.items[5].link + '">"'+ response.items[5].title + '"</a>';
      }
      
      // Fetch country list from datahub.io
      const repondre = await fetch(`https://datahub.io/core/country-list/r/0.json`);
      const dataiso = await repondre.json();

      // Create a map of country names to ISO 2-letter codes
      const isoCodeMap = new Map();
      dataiso.forEach((item) => isoCodeMap.set(item.Name, item.Code));

      // Get the ISO 2-letter code for the given country
      const isoCode = isoCodeMap.get(toTitleCase(promptcountry));
      if (isoCode) {
        // Make a GET request to the World Bank API using the ISO 2-letter code
        const worldBankUrl = "http://api.worldbank.org/v2/country/" + isoCode.toLowerCase() + "?format=json";
        const response = await fetch(worldBankUrl);
        const data = await response.json();

        // Retrieve the capital city, region, and income level from the API response
        const capital = data[1][0].capitalCity;
        const region = data[1][0].region.value;
        const incomeLevel = data[1][0].incomeLevel.value;

        // Update the table cells with the retrieved values
        document.getElementById("capital").innerHTML = capital;
        document.getElementById("region").innerHTML = region;
        document.getElementById("econstatus").innerHTML = incomeLevel;
      } else {
        console.error("ISO code not found for given country.");
      }
    }

    const toTitleCase = (string) => {
      return string.split(" ").map((word) => word[0].toUpperCase() + word.substring(1)).join(" ");
    }
    // Add an event listener to the form's submit button
    var form = document.querySelector("form");
    form.addEventListener("submit", function(event) {
      event.preventDefault();
      searchagenda();
    });
  </script>

  <style>
    .content-container {
      height: calc(100vh - 80px);  /* 80px is the height of the footer */
      overflow: auto;
    }
    header {
      text-align: center; /* Center the content */
      color: white; /* Set the text color */
      padding: 20px; /* Add some padding */
    }
    html,body
    {
      width: 100%;
      height: 100%;
      margin: 0px;
      padding: 0px;
      overflow-x: hidden; 
    }

    header h1 {
      font-size: 36px; /* Set the font size */
      font-weight: bold; /* Make the font bold */
    }

    footer {
      position: absolute;
      bottom: 0;
      height: 80px;
      width: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</html>
